
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../Lab3/Lab3/">
      
      
        <link rel="next" href="../../Lab5/Lab5/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Lab 4 - Actuators - Cyber-Physical Systems</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dacs-motors-and-encoders" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Cyber-Physical Systems" class="md-header__button md-logo" aria-label="Cyber-Physical Systems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cyber-Physical Systems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 4 - Actuators
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../notes/Module0/" class="md-tabs__link">
          
  
  
  Notes

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../pages/LectureSlides/" class="md-tabs__link">
        
  
  
    
  
  Lecture Slides

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../Lab0/Lab0/" class="md-tabs__link">
          
  
  
  Labs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../case_studies/RedLightCameraNIST/" class="md-tabs__link">
          
  
  
  Case Studies

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../pages/rubric/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../in_class_examples/actuators/actuator_control/" class="md-tabs__link">
          
  
  
  In Class Examples

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Cyber-Physical Systems" class="md-nav__button md-logo" aria-label="Cyber-Physical Systems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Cyber-Physical Systems
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Notes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 0 - Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 1 - Computational Systems
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 2 - Computer Architecture and Programming Languages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 3 - Wired Communication Protocols
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 4 - Wireless Communication Protocols
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 5 - Communication Networks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 6 - Sensors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 7 - Actuators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 8 - State Estimation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 9 - Feedback Control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../notes/Module12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module 12 - Systems of Sensors and Actuators
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/LectureSlides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lecture Slides
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab0/Lab0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 0 - Programming Languages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab1/Lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 1 - Wired Communication Protocols
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab2/Lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 2 - Wireless Communication Protocols
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab3/Lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 3 - Sensors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lab 4 - Actuators
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lab 4 - Actuators
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-pwm-overview" class="md-nav__link">
    <span class="md-ellipsis">
      1. PWM Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-h-bridge-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      2. H-Bridge Fundamentals
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. H-Bridge Fundamentals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-vs-enable-pin" class="md-nav__link">
    <span class="md-ellipsis">
      Phase vs. Enable Pin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#h-bridge-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      H-Bridge Mechanism
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-overview-of-callback-functions-in-micropython-on-the-raspberry-pi-pico" class="md-nav__link">
    <span class="md-ellipsis">
      3. Overview of Callback Functions in MicroPython on the Raspberry Pi Pico
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Overview of Callback Functions in MicroPython on the Raspberry Pi Pico">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-callback-functions-work" class="md-nav__link">
    <span class="md-ellipsis">
      How Callback Functions Work
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-syntax-in-micropython" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Syntax in MicroPython
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-lab-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      4. Lab Tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Lab Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-1-spin-the-motor-and-change-direction" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1: Spin the Motor and Change Direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-2-function-to-accept-speed-from-100-to-100" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2: Function to Accept Speed from -100 to 100
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-3-polling-the-encoder-in-a-while-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3: Polling the Encoder in a While Loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-4-interrupt-callback-for-the-encoder" class="md-nav__link">
    <span class="md-ellipsis">
      Task 4: Interrupt Callback for the Encoder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-5-measuring-relationship-between-pwm-and-speed" class="md-nav__link">
    <span class="md-ellipsis">
      Task 5: Measuring Relationship Between PWM and Speed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-discussion-questions" class="md-nav__link">
    <span class="md-ellipsis">
      4. Discussion Questions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab5/Lab5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 5 - Signal Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab6/Lab6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 6 - Computer Vision
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Lab7/Lab7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 7 - Putting it all Together
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Case Studies
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Case Studies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../case_studies/RedLightCameraNIST/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Case Study 1 - Traffic Light Cameras
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../case_studies/DigitalTwins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Case Study 2 - Digital Twins in Gardening & Greenhouses
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pages/rubric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab Report Writing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/zero_tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to Raspberry Pi Zero
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/zero_wifi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Raspberry Pi Zero Wifi Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/pip_apt_tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro to Apt and Pip
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/async_tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Asynchronous Programming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/webrtc_tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebRTC Video Streaming
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    In Class Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            In Class Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../in_class_examples/actuators/actuator_control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Actuator Control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../in_class_examples/computer_vision/computer_vision/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Computer Vision
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../in_class_examples/control/control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control Theory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../in_class_examples/filtering/filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Filtering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../in_class_examples/interrupts/interrupts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hardware Interrupts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../in_class_examples/RANSAC/RANSAC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Random Sampling Consensus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../in_class_examples/signal_processing/signal_processing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Signal Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../in_class_examples/thingspeak/thingspeak/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IoT - ThingSpeak
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../in_class_examples/MQTT/mqtt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IoT - MQTT
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-pwm-overview" class="md-nav__link">
    <span class="md-ellipsis">
      1. PWM Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-h-bridge-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      2. H-Bridge Fundamentals
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. H-Bridge Fundamentals">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-vs-enable-pin" class="md-nav__link">
    <span class="md-ellipsis">
      Phase vs. Enable Pin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#h-bridge-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      H-Bridge Mechanism
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-overview-of-callback-functions-in-micropython-on-the-raspberry-pi-pico" class="md-nav__link">
    <span class="md-ellipsis">
      3. Overview of Callback Functions in MicroPython on the Raspberry Pi Pico
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Overview of Callback Functions in MicroPython on the Raspberry Pi Pico">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-callback-functions-work" class="md-nav__link">
    <span class="md-ellipsis">
      How Callback Functions Work
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-syntax-in-micropython" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Syntax in MicroPython
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-lab-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      4. Lab Tasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Lab Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-1-spin-the-motor-and-change-direction" class="md-nav__link">
    <span class="md-ellipsis">
      Task 1: Spin the Motor and Change Direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-2-function-to-accept-speed-from-100-to-100" class="md-nav__link">
    <span class="md-ellipsis">
      Task 2: Function to Accept Speed from -100 to 100
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-3-polling-the-encoder-in-a-while-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Task 3: Polling the Encoder in a While Loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-4-interrupt-callback-for-the-encoder" class="md-nav__link">
    <span class="md-ellipsis">
      Task 4: Interrupt Callback for the Encoder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-5-measuring-relationship-between-pwm-and-speed" class="md-nav__link">
    <span class="md-ellipsis">
      Task 5: Measuring Relationship Between PWM and Speed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-discussion-questions" class="md-nav__link">
    <span class="md-ellipsis">
      4. Discussion Questions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="dacs-motors-and-encoders">DACs, Motors, and Encoders</h1>
<h2 id="1-pwm-overview">1. PWM Overview</h2>
<p><strong>Pulse Width Modulation (PWM)</strong> is a technique commonly used to control the effective voltage delivered to a load (like a motor) by rapidly switching a digital output between HIGH (on) and LOW (off).</p>
<ul>
<li>
<p>The <strong>duty cycle</strong> is the proportion of time the signal is HIGH in one PWM period.</p>
</li>
<li>
<p>A higher duty cycle means more “on” time relative to “off” time, which increases the average voltage applied to the motor and thus increases its speed.</p>
</li>
<li>
<p>A lower duty cycle means less “on” time and a slower motor speed.</p>
</li>
<li>
<p>The <strong>PWM frequency</strong> is how often these on/off cycles repeat per second. Most motor driver circuits can handle a broad range of PWM frequencies, but you typically choose a frequency high enough to avoid excessive audible noise or motor chatter, but not so high as to cause excessive switching losses.</p>
</li>
</ul>
<p><img alt="PWM Visualization" src="../figs/pwm.png" /></p>
<ul>
<li>For details about to implement PWM in MicroPython on the Raspberry Pi Pico, read the <a href="https://docs.micropython.org/en/latest/rp2/quickref.html#pwm-pulse-width-modulation">documentation</a>. Below is simple example of how to implement PWM. </li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">machine</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pin</span><span class="p">,</span> <span class="n">PWM</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c1"># Create a PWM object on GPIO pin 0 (you can choose any valid PWM pin)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">motor_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">motor_pwm</span> <span class="o">=</span> <span class="n">PWM</span><span class="p">(</span><span class="n">motor_pin</span><span class="p">)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># Set the frequency (e.g., 20kHz)</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="c1"># Note: the PWM pin will not work unless the frequency is set</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="n">pwm</span><span class="o">.</span><span class="n">freq</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="c1"># Set duty cycle (0-65535, where 65535 is 100%)</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">pwm</span><span class="o">.</span><span class="n">duty_u16</span><span class="p">(</span><span class="mi">32767</span><span class="p">)</span>  <span class="c1"># 50% duty cycle</span>
</span></code></pre></div>
<hr />
<h2 id="2-h-bridge-fundamentals">2. H-Bridge Fundamentals</h2>
<p>An <strong>H-bridge</strong> is an electronic circuit that allows you to control the direction of a DC motor by reversing the polarity of the applied voltage. The DRV8835 is a dual H-bridge driver suitable for small brushed DC motors.</p>
<p>In an H-bridge driver:</p>
<ul>
<li><strong>Phase (or direction) pin</strong>: Determines the polarity of the voltage across the motor terminals (i.e., whether the motor spins clockwise or counterclockwise).</li>
<li><strong>Enable (or PWM) pin</strong>: Controls whether the motor driver outputs are active (enabled). When you apply a PWM signal to the enable pin, you effectively turn the motor on and off quickly according to the duty cycle.</li>
</ul>
<h3 id="phase-vs-enable-pin">Phase vs. Enable Pin</h3>
<ul>
<li><strong>Phase pin</strong>: Typically set to <code>HIGH</code> or <code>LOW</code> to indicate the direction in which the motor should spin. For example, <code>PHASE = HIGH</code> might mean clockwise, <code>PHASE = LOW</code> means counterclockwise.</li>
<li><strong>Enable pin</strong>: Receives the PWM signal. When the enable pin is driven with a PWM signal, the driver will turn on/off at the given duty cycle. A 100% duty cycle means fully on, and 0% means fully off.</li>
</ul>
<h3 id="h-bridge-mechanism">H-Bridge Mechanism</h3>
<p>An H-bridge is composed of four switching elements (typically MOSFETs) arranged in an "H" configuration:</p>
<ul>
<li><strong>Basic structure</strong>: Four MOSFETs (Q1, Q2, Q3, Q4) are arranged with the motor connected across the middle of the "H"</li>
<li><strong>Direction control</strong>:<ul>
<li><strong>Forward operation</strong>: Q1 and Q4 are turned ON while Q2 and Q3 remain OFF<ul>
<li>This creates current flow from supply → Q1 → motor → Q4 → ground</li>
</ul>
</li>
<li><strong>Reverse operation</strong>: Q2 and Q3 are turned ON while Q1 and Q4 remain OFF<ul>
<li>This creates current flow from supply → Q3 → motor (in opposite direction) → Q2 → ground</li>
</ul>
</li>
</ul>
</li>
<li><strong>Braking</strong>: <ul>
<li><strong>Active braking</strong>: Either both high-side MOSFETs (Q1, Q3) or both low-side MOSFETs (Q2, Q4) are ON<ul>
<li>This shorts the motor terminals, creating a resistive path for back-EMF</li>
</ul>
</li>
<li><strong>Coast/Free-wheeling</strong>: All MOSFETs are OFF, allowing the motor to spin freely</li>
</ul>
</li>
<li><strong>Prohibited state</strong>: Q1+Q2 ON or Q3+Q4 ON would create a direct short circuit from power to ground</li>
</ul>
<p><img alt="H-Bridge Circuit Diagram" src="../figs/H-bridge.png" /></p>
<hr />
<h2 id="3-overview-of-callback-functions-in-micropython-on-the-raspberry-pi-pico">3. Overview of Callback Functions in MicroPython on the Raspberry Pi Pico</h2>
<p>Callback functions (or interrupts) allow a microcontroller to respond to an external event in near real-time without continuously polling for that event. In the context of a Raspberry Pi Pico running MicroPython, you can configure a GPIO pin to trigger an interrupt when certain conditions are met—such as a rising edge, falling edge, or both edges of a digital signal.</p>
<h3 id="how-callback-functions-work">How Callback Functions Work</h3>
<ol>
<li>Event Trigger: A digital input changes state (e.g., an encoder pin transitions from LOW to HIGH).</li>
<li>Interrupt Service Routine (ISR): When this event is detected, the microcontroller automatically pauses normal program flow and executes a predefined function (the callback).</li>
<li>Return to Main Code: Once the interrupt is handled, the microcontroller returns to whatever it was doing previously.</li>
</ol>
<p>This mechanism frees the main program from constantly monitoring GPIO changes. Instead, the main program can perform other tasks, knowing that it will 'jump' to the callback function whenever the specified event occurs.</p>
<h3 id="basic-syntax-in-micropython">Basic Syntax in MicroPython</h3>
<p>Here's a simplified example for attaching an interrupt in MicroPython on the Raspberry Pi Pico:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">machine</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pin</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1"># Set up the pin as an input with a pull-up resistor</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">button_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">PULL_UP</span><span class="p">)</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1"># Define the callback function</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">button_push_callback</span><span class="p">(</span><span class="n">pin</span><span class="p">):</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Someone pushed the button!!!&#39;</span><span class="p">)</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1"># Attach the callback to the pin, triggered on rising edge</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="n">button_pin</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="n">Pin</span><span class="o">.</span><span class="n">IRQ_FALLING</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="n">button_push_callback</span><span class="p">)</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="c1"># Main loop</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    <span class="c1"># Your main code runs here without needing to check the pin</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="c1"># The callback will handle interrupting this loop and running the callback</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    <span class="c1"># when the button is pushed</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Check the count every second</span>
</span></code></pre></div>
<p>In the example:
- We configure <code>Pin(15)</code> as an input with an internal pull-up resistor.
- We define <code>button_push_callback</code> to print a message whenever the pin sees a falling edge.
- <code>button_pin.irq(...)</code> ties the interrupt trigger to our callback.</p>
<h3 id="considerations">Considerations</h3>
<ul>
<li>Keep the code in your interrupt service routines short, as long routines can block other critical tasks.</li>
<li>If you need to manage shared variables, declare them as <code>global</code> in the callback, or use other concurrency-safe mechanisms.</li>
<li>Hardware debouncing or software filtering may be needed for mechanical switches.</li>
</ul>
<hr />
<h2 id="4-lab-tasks">4. Lab Tasks</h2>
<p>Below are four tasks for students, taking advantage of the Raspberry Pi Pico, the DRV8835 motor driver, and the motor’s encoder.</p>
<h3 id="task-1-spin-the-motor-and-change-direction">Task 1: Spin the Motor and Change Direction</h3>
<ol>
<li>
<p><strong>Objective</strong>: Write code that:</p>
</li>
<li>
<p>Initializes a GPIO pin for PWM output to the “enable” pin of the motor driver.</p>
</li>
<li>Initializes a GPIO pin as a simple digital output to the “phase” pin of the motor driver.</li>
<li>Varies the PWM duty cycle to change speed.</li>
<li>
<p>Changes the phase pin to reverse direction.</p>
</li>
<li>
<p><strong>Guidance</strong>:</p>
</li>
<li>
<p>Select a PWM pin on the Pico and set its frequency (start with 50Hz).</p>
</li>
<li>Set the duty cycle to 50% initially to observe moderate speed.</li>
<li>
<p>Toggle the phase pin to observe direction changes.</p>
</li>
<li>
<p><strong>Example Pseudocode</strong>: this is a very high level example of how you can test your motors. Feel free to modify this code. The import part of this lab is being able to control the direction and speed of the motors.</p>
</li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>declare phase pin
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>declare enable pin
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>declare enable pwm object
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>set pwm frequency
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>set direction with phase pin
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>set pwm duty cycle
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>sleep to 5 seconds
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>set other direction with phase pin
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>set pwm duty cycle
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>sleep for 5 seconds
</span></code></pre></div>
<h3 id="task-2-function-to-accept-speed-from-100-to-100">Task 2: Function to Accept Speed from -100 to 100</h3>
<ol>
<li>
<p><strong>Objective</strong>: Write a function <code>set_motor_speed(int speed)</code> that takes a value in the range <code>[-100, 100]</code>. Negative values will make the motor spin in one direction, positive in the opposite, and the magnitude controls speed.</p>
</li>
<li>
<p><strong>Key Steps</strong>:</p>
</li>
<li>
<p>Determine the direction based on the sign of <code>speed</code>.</p>
<ul>
<li>If <code>speed &lt; 0</code>, <code>PHASE_PIN = LOW</code>.</li>
<li>If <code>speed &gt;= 0</code>, <code>PHASE_PIN = HIGH</code>.</li>
</ul>
</li>
<li>Convert the magnitude of <code>speed</code> (ignoring the sign) to a valid duty cycle (e.g., 0–100%).</li>
<li>
<p>Set the PWM duty cycle accordingly.</p>
</li>
<li>
<p><strong>Possible Pseudocode</strong>:</p>
</li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>function set_motor_speed(speed):
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    Ensure speed is within -100 to 100
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    if speed &gt;= 0:
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        direction_pin = HIGH
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    else:
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        direction_pin = LOW
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    duty_cycle = absolute_value(convert_to_int(speed*65535/100))
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    update phase pin based on sign of speed
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    update duty cycle of pwm pin
</span></code></pre></div>
<h3 id="task-3-polling-the-encoder-in-a-while-loop">Task 3: Polling the Encoder in a While Loop</h3>
<ol>
<li>
<p><strong>Objective</strong>: Continuously monitor the encoder output (one channel) and increment a counter each time the pin transitions from LOW to HIGH. Because we don't know when the encoder </p>
</li>
<li>
<p><strong>Guidance</strong>:</p>
</li>
<li>
<p>Configure a GPIO pin (e.g., <code>ENCODER_PIN</code>)` as input.</p>
</li>
<li>Use a simple while loop that continuously reads the current state of the pin.</li>
<li>Compare the current reading to the previous reading to detect a rising edge (i.e., from LOW to HIGH).</li>
<li>When a rising edge is detected, increment a counter variable.</li>
<li>
<p>For more details on how the encoder works, see the <a href="https://cdn.sparkfun.com/assets/4/b/4/5/4/DG01D-E-sparkfun_Datasheet.pdf">geared motor documentation</a>.</p>
</li>
<li>
<p><strong>Sketch/Pseudocode</strong>:</p>
</li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>ENCODER_PIN = new input pin
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>encoder_count = 0
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>previous_state = read ENCODER_PIN value
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>while (true):
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    current_state = gpio_read(ENCODER_PIN)
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    if (previous_state == LOW and current_state == HIGH):
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>        encoder_count += 1
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    previous_state = current_state
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    // (Optional) Print or log encoder_count
</span></code></pre></div>
<h3 id="task-4-interrupt-callback-for-the-encoder">Task 4: Interrupt Callback for the Encoder</h3>
<ol>
<li>
<p><strong>Objective</strong>: Instead of continuously polling, configure a callback (interrupt service routine) that fires on a rising edge of the encoder pin.</p>
</li>
<li>
<p><strong>Guidance</strong>:</p>
</li>
<li>
<p>Configure <code>ENCODER_PIN</code> to trigger an interrupt on the rising edge.</p>
</li>
<li>Write the interrupt callback function to increment a global or static counter.</li>
<li>The callback can be configured by passing the function into the <code>irq</code> function in the <code>Pin</code> object that you created for your input pin. See the push button example </li>
<li>
<p>The main loop can perform other tasks while the callback handles encoder events in the background.</p>
</li>
<li>
<p><strong>Sketch/Pseudocode</strong>:</p>
</li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>encoder_count = 0
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>// Callback function
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>function encoder_rising_edge_callback():
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    encoder_count += 1
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>// Configuration callback using the irq function in the pin object 
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>// attach_interrupt(ENCODER_PIN, RISING_EDGE, encoder_rising_edge_callback);
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>while (true):
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    // main loop can do other things
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    // use encoder_count whenever needed
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    delay(1000)
</span></code></pre></div>
<h3 id="task-5-measuring-relationship-between-pwm-and-speed">Task 5: Measuring Relationship Between PWM and Speed</h3>
<p>Here, you’ll combine PWM speed control with the encoder’s callback-based measurement to get a rough mapping between “PWM duty cycle” and “counts per second.”</p>
<ol>
<li>
<p><strong>Objective</strong>: For each PWM value (0 through 100 in steps of 10, or some similar step-size):</p>
</li>
<li>
<p>Reset the encoder counter to 0.</p>
</li>
<li>Run the motor at that PWM speed for 1 second.</li>
<li>Record how much the encoder count has increased in that second (i.e., pulses per second).</li>
<li>
<p>Repeat for 100 different speeds or your chosen step size.</p>
</li>
<li>
<p><strong>Nested For-Loop Structure</strong>:</p>
</li>
<li>
<p>The <strong>outer loop</strong> goes through PWM values (0, 10, 20, …, 100).</p>
</li>
<li>
<p>The <strong>inner loop</strong> measures how many counts are accrued in one second at each PWM setting.</p>
</li>
<li>
<p><strong>High-Level Pseudocode</strong>:</p>
</li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>for speed in range(100):
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    set_motor_speed(speed)
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    reset encoder_count to 0
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    sleep(1) //sleep for one second to allow the motor to get up to speed
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    start_time = current_time()
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    while (current_time() - start_time &lt; 1000 milliseconds):
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>        // Wait for 1 second (in real code, you might check if 1 second passed)
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>        // The encoder interrupt is incrementing encoder_count in the background
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    // Now 1 second has elapsed
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    counts = encoder_count
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    print(&quot;PWM =&quot;, speed, &quot;Counts in 1 second =&quot;, counts)
</span></code></pre></div>
<ul>
<li>You can store each <code>counts</code> value in an array or simply print it out for further analysis.</li>
</ul>
<hr />
<h2 id="4-discussion-questions">4. Discussion Questions</h2>
<ul>
<li>What are the advantages of using callback interrupts over the polling method for handling asynchronous events? </li>
<li>Give an example application where polling might be a better choice than using interrupts.</li>
<li>Can you think of any drawbacks to using callback interrupts?</li>
<li>Give an example application where interrupts might be a better choice than a polling method.</li>
<li>Briefly discuss the applications of these concepts to CPS and broader system design. </li>
<li>What is the nature of the relationship between PWM values and motor speed? Is a linear fit a good assumption?</li>
<li>What factors impact the relationship between the PWM value and motor speed? Are these factors constant, or do they change over time?</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.breadcrumbs", "navigation.path", "navigation.top", "navigation.tracking", "toc.follow", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>